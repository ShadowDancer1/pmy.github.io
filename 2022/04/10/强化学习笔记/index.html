<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo_icon001.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo_icon001.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="è®°å½•è‡ªå·±å¼ºåŒ–å­¦ä¹ å­¦ä¹ è¿‡ç¨‹">
<meta property="og:type" content="article">
<meta property="og:title" content="å¼ºåŒ–å­¦ä¹ ç¬”è®°">
<meta property="og:url" content="http://example.com/2022/04/10/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="åŠ¨æ€">
<meta property="og:description" content="è®°å½•è‡ªå·±å¼ºåŒ–å­¦ä¹ å­¦ä¹ è¿‡ç¨‹">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2022/04/11/VeLkxvf93CpXI4l.jpg">
<meta property="og:image" content="https://s2.loli.net/2022/04/11/sG1vbJLijYZStgD.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/11/Y8dkctwnWX3xJOy.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/13/APTFzEkv1ZMiGQx.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/13/SOyXw3Vgd7WCtBk.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/13/zJUQEgT1XStOHxf.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/13/riFPYbIwQ7jLWfm.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/13/kEdlX1IupJPsroq.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/13/IYFwo8DcpELsXnP.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/14/15EzaUgscWky89t.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/14/narPG5kOxpNVwD9.png">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2022/04/14/371ae56e60eaa013.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/04/14/L1kh1P.png">
<meta property="og:image" content="https://img30.360buyimg.com/pop/jfs/t1/151963/30/22549/983753/6257f23eEba2269cf/141f1bcf9aa79f54.png">
<meta property="og:image" content="https://img30.360buyimg.com/pop/jfs/t1/214725/25/17102/632112/6257f21bE89ca862a/774c8fe0fdd93b77.png">
<meta property="og:image" content="https://img30.360buyimg.com/pop/jfs/t1/188468/40/23237/1878038/6257f051Ef267260a/0b049abbd92a7cce.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/16/u3MjVKWYFRAIiTb.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/16/Yte1AsnRpvOm3bw.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/16/pZjodmA9li34EIV.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/16/8mg9yo1sVQJuDbk.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/16/M78EQ53ghfvyTO2.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/17/ObnDNdgfz4HYpcC.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/18/xZERljQ4V6BwnLk.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/18/3bidn78rJN2HkKw.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/18/1nHLEcAvhJflDOu.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/18/tYpyQ8vnWduIqe1.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/18/YKlXsjvpW3STLge.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/18/8UcKnF321vfCglZ.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/19/lR5OxEh7myNibTt.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/19/bp5Zd3xfEAnsYJz.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/19/GJ58IULaNuQFMyf.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/19/PFIsq5jQR1Ogc7h.png">
<meta property="og:image" content="https://pic.rmb.bdstatic.com/bjh/db7ae6e4b2c3a5d1cafcbdee2fef5b74.png">
<meta property="og:image" content="https://pic.rmb.bdstatic.com/bjh/2872fb7c5072cdfd51f58d020be79b47.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/20/jKGMJOwI5uBi8TZ.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/20/kwxHRvQ6UEIlshf.png">
<meta property="og:image" content="https://pic.rmb.bdstatic.com/bjh/e0beb3014d9953aaf1deac573d782228.png">
<meta property="og:image" content="https://pic.rmb.bdstatic.com/bjh/e5ce498c4f16a558d8e7becbf22005ef.png">
<meta property="og:image" content="https://pic.rmb.bdstatic.com/bjh/5e6b9882c2dae56a41a99a638ec529bb.png">
<meta property="og:image" content="https://s2.loli.net/2022/04/21/STYRBn8igxw9FO4.jpg">
<meta property="og:image" content="https://m.360buyimg.com/babel/jfs/t1/191259/27/23918/162019/6278e481Eac0df82e/e2895d20785cf286.png">
<meta property="article:published_time" content="2022-04-10T09:18:13.000Z">
<meta property="article:modified_time" content="2022-05-19T03:31:27.494Z">
<meta property="article:author" content="P.M.Y">
<meta property="article:tag" content="å¼ºåŒ–å­¦ä¹ ">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2022/04/11/VeLkxvf93CpXI4l.jpg">

<link rel="canonical" href="http://example.com/2022/04/10/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>å¼ºåŒ–å­¦ä¹ ç¬”è®° | åŠ¨æ€</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?3be792f493e893537d1d13a6c8b3b054";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">åŠ¨æ€</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/10/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/creator.jpg">
      <meta itemprop="name" content="P.M.Y">
      <meta itemprop="description" content="è®°å½•Â·åˆ†äº«Â·è¿›æ­¥">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åŠ¨æ€">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          å¼ºåŒ–å­¦ä¹ ç¬”è®°
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">

	    
            	<i class="fas fa-thumbtack"></i>
            	<font color=E90A1F>ç½®é¡¶</font>
            	<span class="post-meta-divider">|</span>
            

              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2022-04-10 17:18:13" itemprop="dateCreated datePublished" datetime="2022-04-10T17:18:13+08:00">2022-04-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-05-19 11:31:27" itemprop="dateModified" datetime="2022-05-19T11:31:27+08:00">2022-05-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><img src="https://s2.loli.net/2022/04/11/VeLkxvf93CpXI4l.jpg" alt="ismail-inceoglu-cauligrx"></p>
<p>è®°å½•è‡ªå·±å¼ºåŒ–å­¦ä¹ å­¦ä¹ è¿‡ç¨‹</p>
<span id="more"></span>
<h3 id="4æœˆ11æ—¥"><a href="#4æœˆ11æ—¥" class="headerlink" title="4æœˆ11æ—¥"></a>4æœˆ11æ—¥</h3><ol>
<li><p>reinforcement learningç®—æ³•çš„æœ¬è´¨å°±æ˜¯è®©agentè·å¾—çŠ¶æ€è½¬ç§»çŸ©é˜µ</p>
</li>
<li><p>ç›‘ç£å­¦ä¹ ä¸å¼ºåŒ–å­¦ä¹ çš„åŒºåˆ«ï¼š</p>
<p>ç›‘ç£å­¦ä¹ â€”â€”Learning from teacher</p>
<p>å¼ºåŒ–å­¦ä¹ â€”â€”Learning from experience</p>
<p>Alpha Go å…ˆè¿›è¡Œç›‘ç£å­¦ä¹ ï¼Œè·å¾—ä¸é”™çš„æ•ˆæœä¹‹åå†è¿›è¡Œå¼ºåŒ–å­¦ä¹ ã€‚</p>
</li>
<li><p>å¼ºåŒ–å­¦ä¹ çš„å›°éš¾ä¹‹å¤„</p>
<p>1ï¼‰Reward delay</p>
<p>2ï¼‰Agentçš„è¡Œä¸ºä¼šå¯¹ä¹‹åçš„æƒ…å†µäº§ç”Ÿå½±å“ï¼ˆéœ€è¦Agentå…·å¤‡æ¢ç´¢èƒ½åŠ›ï¼‰</p>
</li>
<li><p>Machine Learning â‰ˆ Looking for a Function</p>
<p>åœ¨å¼ºåŒ–å­¦ä¹ ä¸­ï¼Œè¿™é‡Œçš„Functionç›¸å½“äºAction = Î (Observation)</p>
</li>
<li><p>å¼ºåŒ–å­¦ä¹ æ–¹æ³•</p>
<p>1ï¼‰model-based(é’ˆå¯¹æœªæ¥æƒ…å†µè¿›è¡Œé¢„æµ‹)</p>
<p>2ï¼‰model-free (policy-based and/or value-based)</p>
<p>â€‹    ä¾‹ï¼šAlpha Goé‡‡ç”¨çš„æ˜¯ policy-based+value-based+model-based</p>
</li>
<li><p>åœ¨ä¸€åœºæ¸¸æˆé‡Œé¢ï¼Œæˆ‘ä»¬æŠŠç¯å¢ƒè¾“å‡ºçš„ s è·Ÿæ¼”å‘˜è¾“å‡ºçš„è¡Œä¸º a ï¼ŒæŠŠ s  è·Ÿ a  å…¨éƒ¨ä¸²èµ·æ¥ï¼Œ å«åšä¸€ä¸ª <code>Trajectory(è½¨è¿¹)</code>ï¼Œå¦‚ä¸‹å¼æ‰€ç¤ºã€‚</p>
<script type="math/tex; mode=display">
\text { Trajectory } \tau=\left\{s_{1}, a_{1}, s_{2}, a_{2}, \cdots, s_{t}, a_{t}\right\}</script></li>
<li><p>ä½ å¯ä»¥è®¡ç®—æ¯ä¸€ä¸ªè½¨è¿¹å‘ç”Ÿçš„æ¦‚ç‡ã€‚å‡è®¾ç°åœ¨æ¼”å‘˜çš„å‚æ•°å·²ç»è¢«ç»™å®šäº†è¯ï¼Œå°±æ˜¯ $\theta$ã€‚æ ¹æ® $\theta$ï¼Œä½ å…¶å®å¯ä»¥è®¡ç®—æŸä¸€ä¸ªè½¨è¿¹å‘ç”Ÿçš„æ¦‚ç‡ï¼Œä½ å¯ä»¥è®¡ç®—æŸä¸€ä¸ªå›åˆé‡Œé¢å‘ç”Ÿè¿™æ ·å­çŠ¶å†µçš„æ¦‚ç‡ã€‚</p>
<script type="math/tex; mode=display">
\begin{aligned} p_{\theta}(\tau) &=p\left(s_{1}\right) p_{\theta}\left(a_{1} | s_{1}\right) p\left(s_{2} | s_{1}, a_{1}\right) p_{\theta}\left(a_{2} | s_{2}\right) p\left(s_{3} | s_{2}, a_{2}\right) \cdots \ \\ &=p\left(s_{1}\right) \prod_{t=1}^{T} p_{\theta}\left(a_{t} | s_{t}\right) p\left(s_{t+1} | s_{t}, a_{t}\right) \end{aligned}</script></li>
<li><p>ä½ å¯ä»¥æ ¹æ® $\theta$ ç®—å‡ºæŸä¸€ä¸ªè½¨è¿¹ $\tau$ å‡ºç°çš„æ¦‚ç‡ï¼Œæ¥ä¸‹æ¥è®¡ç®—è¿™ä¸ª $\tau$ çš„æ€»å¥–åŠ±æ˜¯å¤šå°‘ã€‚æ€»å¥–åŠ±ä½¿ç”¨è¿™ä¸ª $\tau$ å‡ºç°çš„æ¦‚ç‡è¿›è¡ŒåŠ æƒï¼Œå¯¹æ‰€æœ‰çš„ $\tau$ è¿›è¡Œæ±‚å’Œï¼Œå°±æ˜¯æœŸæœ›å€¼ã€‚ç»™å®šä¸€ä¸ªå‚æ•°ï¼Œä½ ä¼šå¾—åˆ°çš„æœŸæœ›å€¼ã€‚</p>
<script type="math/tex; mode=display">
\bar{R}_{\theta}=\sum_{\tau} R(\tau) p_{\theta}(\tau)=E_{\tau \sim p_{\theta}(\tau)}[R(\tau)]</script></li>
<li><p>è®¡ç®—æ¢¯åº¦</p>
<script type="math/tex; mode=display">
\nabla \bar{R}_{\theta}=\frac{1}{N} \sum_{n=1}^{N} \sum_{t=1}^{T_{n}} R\left(\tau^{n}\right) \nabla \log p_{\theta}\left(a_{t}^{n} | s_{t}^{n}\right)</script></li>
<li><p>å¼ºåŒ–å­¦ä¹ çš„ä¸€ä¸‹Tips</p>
<p>1ï¼‰æ·»åŠ baseline</p>
<script type="math/tex; mode=display">
\nabla \bar{R}_{\theta} \approx \frac{1}{N} \sum_{n=1}^{N} \sum_{t=1}^{T_{n}}\left(R\left(\tau^{n}\right)-b\right) \nabla \log p_{\theta}\left(a_{t}^{n} \mid s_{t}^{n}\right) \\ b \approx E[R(\tau)]</script><p>2ï¼‰ç»™æ¯ä¸ªåŠ¨ä½œåˆé€‚çš„åˆ†æ•°</p>
</li>
</ol>
<p><img src="https://s2.loli.net/2022/04/11/sG1vbJLijYZStgD.png" alt="4.17"></p>
<p>â€‹    æœ¬æ¥çš„æƒé‡æ˜¯æ•´åœºæ¸¸æˆçš„å¥–åŠ±çš„æ€»å’Œï¼Œç°åœ¨æ”¹æˆä»æŸä¸ªæ—¶é—´ t å¼€å§‹ï¼Œå‡è®¾è¿™ä¸ªåŠ¨ä½œæ˜¯åœ¨ t è¿™ä¸ªæ—¶é—´ç‚¹æ‰€æ‰§è¡Œ       çš„ï¼Œä» t è¿™ä¸ªæ—¶é—´ç‚¹ä¸€ç›´åˆ°æ¸¸æˆç»“æŸæ‰€æœ‰å¥–åŠ±çš„æ€»å’Œï¼Œæ‰çœŸçš„ä»£è¡¨è¿™ä¸ªåŠ¨ä½œæ˜¯å¥½çš„è¿˜æ˜¯ä¸å¥½çš„ã€‚</p>
<p>â€‹    3ï¼‰æŠ˜æ‰£å›æŠ¥</p>
<p>â€‹    4ï¼‰ä¼˜åŠ¿å‡½æ•°</p>
<p>â€‹    æŠŠ R-b è¿™ä¸€é¡¹åˆèµ·æ¥ï¼Œæˆ‘ä»¬ç»Ÿç§°ä¸º<code>ä¼˜åŠ¿å‡½æ•°(advantage function)</code>ï¼Œ ç”¨ <code>A</code> æ¥ä»£è¡¨ä¼˜åŠ¿å‡½æ•°ã€‚ä¼˜åŠ¿å‡½æ•°å–å†³äº s å’Œ aï¼Œæˆ‘ä»¬å°±æ˜¯è¦è®¡ç®—çš„æ˜¯åœ¨æŸä¸€ä¸ªçŠ¶æ€ s é‡‡å–æŸä¸€ä¸ªåŠ¨ä½œ a çš„æ—¶å€™ï¼Œä¼˜åŠ¿å‡½æ•°æœ‰å¤šå¤§ã€‚</p>
<p><img src="https://s2.loli.net/2022/04/11/Y8dkctwnWX3xJOy.png" alt="4.19"></p>
<p>ä¼˜åŠ¿å‡½æ•°çš„æ„ä¹‰åœ¨äºï¼Œå‡è®¾æˆ‘ä»¬åœ¨æŸä¸€ä¸ªçŠ¶æ€ $s_t$  æ‰§è¡ŒæŸä¸€ä¸ªåŠ¨ä½œ $a_t$ï¼Œç›¸è¾ƒäºå…¶ä»–å¯èƒ½çš„åŠ¨ä½œï¼Œå®ƒæœ‰å¤šå¥½ã€‚å®ƒåœ¨æ„çš„ä¸æ˜¯ä¸€ä¸ªç»å¯¹çš„å¥½ï¼Œè€Œæ˜¯ç›¸å¯¹çš„å¥½ï¼Œå³<code>ç›¸å¯¹ä¼˜åŠ¿(relative advantage)</code>ã€‚å› ä¸ºä¼šå‡æ‰ä¸€ä¸ª bï¼Œå‡æ‰ä¸€ä¸ª åŸºçº¿ï¼Œ æ‰€ä»¥è¿™ä¸ªä¸œè¥¿æ˜¯ç›¸å¯¹çš„å¥½ï¼Œä¸æ˜¯ç»å¯¹çš„å¥½ã€‚ $A^{\theta}\left(s_{t}, a_{t}\right)$ é€šå¸¸å¯ä»¥æ˜¯ç”±ä¸€ä¸ªç½‘ç»œä¼°è®¡å‡ºæ¥çš„ï¼Œè¿™ä¸ªç½‘ç»œå«åš criticã€‚</p>
<hr>
<h3 id="4æœˆ12æ—¥"><a href="#4æœˆ12æ—¥" class="headerlink" title="4æœˆ12æ—¥"></a>4æœˆ12æ—¥</h3><ol>
<li><p>Behavior Cloningçš„ç¼ºç‚¹åœ¨äºæ— æ³•å‘Šè¯‰Machineå“ªäº›æ˜¯é‡è¦çš„ï¼Œå“ªäº›æ˜¯ä¸é‡è¦çš„ã€‚</p>
</li>
<li><p>Two Learning Scenarios:</p>
<p>1ï¼‰å¼ºåŒ–å­¦ä¹ </p>
<p>2ï¼‰Learning by demonstration</p>
</li>
<li><p>Actor-Criticç®—æ³•ï¼š</p>
<p>1ï¼‰Training an Actor</p>
<p>2ï¼‰Training a Critic</p>
<p>3ï¼‰Actor + Critic</p>
</li>
<li><p>ä¸€ä¸ª Critic æ— æ³•å†³å®š Actionï¼ŒCritic çš„ä½œç”¨æ˜¯è¯„ä¼°ä¸€ä¸ª actor Î  å¥½ä¸å¥½ã€‚ï¼ˆç»™å‡ºæœ€ç»ˆå¥–åŠ±çš„æœŸæœ›ï¼‰</p>
<p>è¯„è®ºå®¶(Critic)æ˜¯æŒ‡å€¼å‡½æ•° $V^{\pi}(s)$ï¼Œå¯¹å½“å‰ç­–ç•¥çš„å€¼å‡½æ•°è¿›è¡Œä¼°è®¡ï¼Œå³è¯„ä¼°æ¼”å‘˜çš„å¥½åã€‚</p>
</li>
</ol>
<hr>
<h3 id="4æœˆ13æ—¥"><a href="#4æœˆ13æ—¥" class="headerlink" title="4æœˆ13æ—¥"></a>4æœˆ13æ—¥</h3><ol>
<li><p>DQNç®—æ³•å­¦ä¹ </p>
<p>1ï¼‰æœ‰ä¸€ç§ Critic æ˜¯ <code>state value function(çŠ¶æ€ä»·å€¼å‡½æ•°)</code>ã€‚è¯„è®ºå®¶çš„è¾“å‡ºæ˜¯è·Ÿæ¼”å‘˜æœ‰å…³çš„ï¼ŒçŠ¶æ€çš„ä»·å€¼å…¶å®å–      å†³äºä½ çš„æ¼”å‘˜ï¼Œå½“æ¼”å‘˜å˜çš„æ—¶å€™ï¼ŒçŠ¶æ€ä»·å€¼å‡½æ•°çš„è¾“å‡ºå…¶å®ä¹Ÿæ˜¯ä¼šè·Ÿç€æ”¹å˜çš„ã€‚</p>
<p>2ï¼‰è¡¡é‡çŠ¶æ€ä»·å€¼å‡½æ•° $V^{\pi}(s)$ çš„ä¸¤ç§æ–¹æ³•ï¼š</p>
<p>â€‹      ï¼ˆ1ï¼‰Monte-Carlo(MC)-based</p>
<p>â€‹                åœ¨è®­ç»ƒçš„æ—¶å€™ï¼Œ å®ƒå°±æ˜¯ä¸€ä¸ªå›å½’é—®é¢˜ã€‚ç½‘ç»œçš„è¾“å‡ºå°±æ˜¯ä¸€ä¸ªå€¼ï¼Œä½ å¸Œæœ›åœ¨è¾“å…¥ $s_a$ çš„æ—¶å€™ï¼Œè¾“å‡º                 çš„å€¼è·Ÿ $G_a$ è¶Šè¿‘è¶Šå¥½ï¼Œè¾“å…¥ $s_b$ çš„æ—¶å€™ï¼Œè¾“å‡ºçš„å€¼è·Ÿ $G_b$ è¶Šè¿‘è¶Šå¥½ã€‚</p>
<p><img src="https://s2.loli.net/2022/04/13/APTFzEkv1ZMiGQx.png" alt=""></p>
<p>â€‹      ï¼ˆ2ï¼‰Temporal-difference(æ—¶åºå·®åˆ†)</p>
<p>â€‹                TD-based çš„æ–¹æ³•ä¸éœ€è¦æŠŠæ¸¸æˆç©åˆ°åº•ï¼Œåªè¦åœ¨æ¸¸æˆçš„æŸä¸€ä¸ªæƒ…å†µï¼ŒæŸä¸€ä¸ªçŠ¶æ€ $s_t$ çš„æ—¶å€™ï¼Œé‡‡å–åŠ¨                ä½œ $a_t$ å¾—åˆ°å¥–åŠ±$r_t$ ï¼Œè·³åˆ°çŠ¶æ€ $s_{t+1}$ï¼Œå°±å¯ä»¥ä½¿ç”¨ TD çš„æ–¹æ³•ã€‚</p>
<p>â€‹                <script type="math/tex">V^{\pi}\left(s_{t}\right)=V^{\pi}\left(s_{t+1}\right)+r_{t}</script></p>
<p><img src="https://s2.loli.net/2022/04/13/SOyXw3Vgd7WCtBk.png" alt=""></p>
<p>3ï¼‰å¦ä¸€ç§ Ctitic æ˜¯ Q-functionï¼Œä¹Ÿå«<code>state-action value function(çŠ¶æ€-åŠ¨ä½œä»·å€¼å‡½æ•°)</code>ã€‚çŠ¶æ€-åŠ¨ä½œä»·å€¼        å‡½æ•°çš„è¾“å…¥æ˜¯ä¸€ä¸ªçŠ¶æ€ã€åŠ¨ä½œå¯¹ï¼Œå®ƒçš„æ„æ€æ˜¯è¯´ï¼Œåœ¨æŸä¸€ä¸ªçŠ¶æ€é‡‡å–æŸä¸€ä¸ªåŠ¨ä½œï¼Œå‡è®¾æˆ‘ä»¬éƒ½ä½¿ç”¨æ¼”å‘˜         $\pi$ ï¼Œå¾—åˆ°çš„ç´¯ç§¯å¥–åŠ±çš„æœŸæœ›å€¼æœ‰å¤šå¤§ã€‚</p>
<p>â€‹       æ¨å¯¼å¯å¾—ï¼š</p>
<script type="math/tex; mode=display">
\begin{aligned} V^{\pi}(s) &\le Q^{\pi}(s,\pi'(s)) \ \\ &=E\left[r_{t}+V^{\pi}\left(s_{t+1}\right) | s_{t}=s, a_{t}=\pi^{\prime}\left(s_{t}\right)\right]\ \\&\le E\left[r_{t}+Q^{\pi}\left(s_{t+1}, \pi^{\prime}\left(s_{t+1}\right)\right) | s_{t}=s, a_{t}=\pi^{\prime}\left(s_{t}\right)\right] \ \\&=E\left[r_{t}+r_{t+1}+V^{\pi}\left(s_{t+2}\right) |s_{t}=s, a_{t}=\pi^{\prime}\left(s_{t}\right)\right] \ \\ & \le E\left[r_{t}+r_{t+1}+Q^{\pi}\left(s_{t+2},\pi'(s_{t+2}\right) | s_{t}=s, a_{t}=\pi^{\prime}\left(s_{t}\right)\right] \ \\ & = E\left[r_{t}+r_{t+1}+r_{t+2}+V^{\pi}\left(s_{t+3}\right) |s_{t}=s, a_{t}=\pi^{\prime}\left(s_{t}\right)\right] \ \\ & \le \cdots\ \\ & \le E\left[r_{t}+r_{t+1}+r_{t+2}+\cdots | s_{t}=s, a_{t}=\pi^{\prime}\left(s_{t}\right)\right] \ \\ & = V^{\pi'}(s) \end{aligned}</script><p>â€‹        å› æ­¤ï¼š</p>
<p>â€‹        <script type="math/tex">V^{\pi}(s)\le V^{\pi'}(s)</script></p>
</li>
</ol>
<p>â€‹        4ï¼‰DQNä¸­ç”¨åˆ°çš„ä¸€äº›Tips:</p>
<p>â€‹              ï¼ˆ1ï¼‰ç›®æ ‡ç½‘ç»œ</p>
<p><img src="https://s2.loli.net/2022/04/13/zJUQEgT1XStOHxf.png" alt=""></p>
<p>â€‹            ï¼ˆ2ï¼‰æ¢ç´¢(Exploration)</p>
<p><img src="https://s2.loli.net/2022/04/13/riFPYbIwQ7jLWfm.png" alt=""></p>
<p>â€‹            ï¼ˆ3ï¼‰Experience Replay(ç»éªŒå›æ”¾)</p>
<p>â€‹                     æ„å»ºä¸€ä¸ª <code>Replay Buffer</code>ï¼Œç”¨å…ˆæœ‰æŸä¸€ä¸ªç­–ç•¥ $\pi$ å»è·Ÿç¯å¢ƒåšäº’åŠ¨ï¼Œç„¶åå®ƒä¼šå»æ”¶é›†æ•°æ®ï¼Œå¹¶åˆ©ç”¨æ”¶                    é›†åˆ°çš„æ•°æ®æ›´æ–°å‚æ•°ã€‚</p>
<p><img src="https://s2.loli.net/2022/04/13/kEdlX1IupJPsroq.png" alt="6.18"></p>
<p>â€‹    5ï¼‰DQNç®—æ³•æ€»ç»“</p>
<p>â€‹          <img src="https://s2.loli.net/2022/04/13/IYFwo8DcpELsXnP.png" alt="6.19"></p>
<hr>
<h3 id="4æœˆ14æ—¥"><a href="#4æœˆ14æ—¥" class="headerlink" title="4æœˆ14æ—¥"></a>4æœˆ14æ—¥</h3><ol>
<li><p>DQNè¿›é˜¶æŠ€å·§</p>
<p>1ï¼‰Double DQN</p>
<p><img src="https://s2.loli.net/2022/04/14/15EzaUgscWky89t.png" alt=""></p>
<p>2ï¼‰Dueling DQN</p>
<p><img src="https://s2.loli.net/2022/04/14/narPG5kOxpNVwD9.png" alt="7.6"></p>
<p>3ï¼‰Prioritized Experience Replay</p>
<p><img src="https://s3.bmp.ovh/imgs/2022/04/14/371ae56e60eaa013.png" alt=""></p>
<p>4ï¼‰Balance between MC and TD</p>
<p><img src="https://s1.ax1x.com/2022/04/14/L1kh1P.png" alt="L1kh1P.png"></p>
<p>5ï¼‰Noisy Net</p>
<p><img src="https://img30.360buyimg.com/pop/jfs/t1/151963/30/22549/983753/6257f23eEba2269cf/141f1bcf9aa79f54.png" alt="7.10.png"></p>
<p>6ï¼‰Distributional Q-function</p>
<p><img src="https://img30.360buyimg.com/pop/jfs/t1/214725/25/17102/632112/6257f21bE89ca862a/774c8fe0fdd93b77.png" alt="7.12.png"></p>
<p>7ï¼‰Rainbow</p>
<p><img src="https://img30.360buyimg.com/pop/jfs/t1/188468/40/23237/1878038/6257f051Ef267260a/0b049abbd92a7cce.png" alt="7.13.png"></p>
</li>
</ol>
<hr>
<h3 id="4æœˆ15æ—¥"><a href="#4æœˆ15æ—¥" class="headerlink" title="4æœˆ15æ—¥"></a>4æœˆ15æ—¥</h3><p>å®ç° DQNç®—æ³• ç© MountainCar-v0ï¼Œå¹¶èƒ½å¤Ÿä¿å­˜æ¨¡å‹å’ŒåŠ è½½æ¨¡å‹ã€‚</p>
<p><img src="https://s2.loli.net/2022/04/16/u3MjVKWYFRAIiTb.png" alt=""></p>
<hr>
<h3 id="4æœˆ16æ—¥"><a href="#4æœˆ16æ—¥" class="headerlink" title="4æœˆ16æ—¥"></a>4æœˆ16æ—¥</h3><ol>
<li><p>PPOç®—æ³•å­¦ä¹ </p>
<p>1ï¼‰on-policy å’Œ off-policy</p>
</li>
</ol>
<p>â€‹     å¦‚æœè¦å­¦ä¹ çš„ agent è·Ÿå’Œç¯å¢ƒäº’åŠ¨çš„ agent æ˜¯åŒä¸€ä¸ªçš„è¯ï¼Œ è¿™ä¸ªå«åš<code>on-policy(åŒç­–ç•¥)</code>ã€‚</p>
<p>â€‹     å¦‚æœè¦å­¦ä¹ çš„ agent è·Ÿå’Œç¯å¢ƒäº’åŠ¨çš„ agent ä¸æ˜¯åŒä¸€ä¸ªçš„è¯ï¼Œ é‚£è¿™ä¸ªå«åš<code>off-policy(å¼‚ç­–ç•¥)</code>ã€‚</p>
<p> 2ï¼‰policy gradient æ˜¯ä¸€ä¸ª on-policy çš„ç®—æ³•ã€‚</p>
<p> 3ï¼‰<code>è¿‘ç«¯ç­–ç•¥ä¼˜åŒ–(Proximal Policy Optimizationï¼Œç®€ç§° PPO)</code> æ˜¯ policy gradient çš„ä¸€ä¸ªå˜å½¢ï¼Œå®ƒæ˜¯ç°      åœ¨  OpenAI é»˜è®¤çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•ã€‚</p>
<script type="math/tex; mode=display">
\nabla \bar{R}{\theta}=E{\tau \sim p_{\theta}(\tau)}\left[R(\tau) \nabla \log p_{\theta}(\tau)\right]</script><p> 4ï¼‰é‡è¦æ€§é‡‡æ ·(Importance Samplingï¼ŒIS)</p>
<script type="math/tex; mode=display">
E_{x \sim p}[f(x)] \approx \frac{1}{N} \sum_{i=1}^N f(x^i)</script><p>â€‹      æœŸæœ›å€¼ $E_{x \sim p}[f(x)]$ å…¶å®å°±æ˜¯ $\int f(x) p(x) dx$ï¼Œå¯¹å…¶åšå¦‚ä¸‹çš„å˜æ¢ï¼š</p>
<script type="math/tex; mode=display">
\int f(x) p(x) d x=\int f(x) \frac{p(x)}{q(x)} q(x) d x=E_{x \sim q}[f(x){\frac{p(x)}{q(x)}}]</script><p>â€‹      å°±å¯ä»¥å†™æˆå¯¹ q é‡Œé¢æ‰€é‡‡æ ·å‡ºæ¥çš„ $x$ å–æœŸæœ›å€¼ï¼Œå…¶ä¸­ $\frac{p(x)}{q(x)}$ ä¸º<code>é‡è¦æ€§æƒé‡(importance weight)</code> ã€‚</p>
<p>â€‹      åœ¨å®ç°ä¸Šï¼Œp å’Œ q ä¸èƒ½å·®å¤ªå¤šã€‚å› ä¸ºæ–¹å·®ä¸åŒï¼š</p>
<script type="math/tex; mode=display">
\operatorname{Var}_{x \sim p}[f(x)]=E_{x \sim p}\left[f(x)^{2}\right]-\left(E_{x \sim p}[f(x)]\right)^{2} \\
\begin{aligned} \operatorname{Var}_{x \sim q}\left[f(x) \frac{p(x)}{q(x)}\right] &=E_{x \sim q}\left[\left(f(x) \frac{p(x)}{q(x)}\right)^{2}\right]-\left(E_{x \sim q}\left[f(x) \frac{p(x)}{q(x)}\right]\right)^{2} \ \\ &=E_{x \sim p}\left[f(x)^{2} \frac{p(x)}{q(x)}\right]-\left(E_{x \sim p}[f(x)]\right)^{2} \end{aligned}</script><p><img src="https://s2.loli.net/2022/04/16/Yte1AsnRpvOm3bw.png" alt="5.4"></p>
<p> 5ï¼‰on-policy  â€”-&gt;  off-policy</p>
<p><img src="https://s2.loli.net/2022/04/16/pZjodmA9li34EIV.png" alt="5.6"></p>
<script type="math/tex; mode=display">
E_{\left(s_{t}, a_{t}\right) \sim \pi_{\theta}}\left[A^{\theta}\left(s_{t}, a_{t}\right) \nabla \log p_{\theta}\left(a_{t}^{n} | s_{t}^{n}\right)\right] \\
 =E_{\left(s_{t}, a_{t}\right) \sim \pi_{\theta^{\prime}}}\left[\frac{p_{\theta}\left(s_{t}, a_{t}\right)}{p_{\theta^{\prime}}\left(s_{t}, a_{t}\right)} A^{\theta}\left(s_{t}, a_{t}\right) \nabla \log p_{\theta}\left(a_{t}^{n} | s_{t}^{n}\right)\right] \\
 =E_{\left(s_{t}, a_{t}\right) \sim \pi_{\theta^{\prime}}}\left[\frac{p_{\theta}\left(a_{t} | s_{t}\right)}{p_{\theta^{\prime}}\left(a_{t} | s_{t}\right)} \frac{p_{\theta}\left(s_{t}\right)}{p_{\theta^{\prime}}\left(s_{t}\right)} A^{\theta^{\prime}}\left(s_{t}, a_{t}\right) \nabla \log p_{\theta}\left(a_{t}^{n} | s_{t}^{n}\right)\right] \\
 =E_{\left(s_{t}, a_{t}\right) \sim \pi_{\theta^{\prime}}}\left[\frac{p_{\theta}\left(a_{t} | s_{t}\right)}{p_{\theta^{\prime}}\left(a_{t} | s_{t}\right)} A^{\theta^{\prime}}\left(s_{t}, a_{t}\right) \nabla \log p_{\theta}\left(a_{t}^{n} | s_{t}^{n}\right)\right]</script><p>  ç°åœ¨æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªæ–°çš„ç›®æ ‡å‡½æ•°:</p>
<script type="math/tex; mode=display">
J^{\theta^{\prime}}(\theta)=E_{\left(s_{t}, a_{t}\right) \sim \pi_{\theta^{\prime}}}\left[\frac{p_{\theta}\left(a_{t} | s_{t}\right)}{p_{\theta^{\prime}}\left(a_{t} | s_{t}\right)} A^{\theta^{\prime}}\left(s_{t}, a_{t}\right)\right]</script><p>6ï¼‰<strong>PPO æ˜¯ on-policy çš„ç®—æ³•</strong>ï¼Œ<strong>åœ¨ PPO ä¸­ $\thetaâ€™$ æ˜¯ $\theta_{\text{old}}$ï¼Œå³ behavior policy ä¹Ÿæ˜¯ $\theta$</strong>ã€‚å¦‚æœ $p_{\theta}\left(a_{t} | s_{t}\right)$ è·Ÿ $p_{\thetaâ€™}\left(a_{t} | s_{t}\right)$ è¿™ä¸¤ä¸ªåˆ†å¸ƒå·®å¤ªå¤šçš„è¯ï¼Œé‡è¦æ€§é‡‡æ ·çš„ç»“æœå°±ä¼šä¸å¥½ã€‚è¿™ä¹Ÿæ˜¯PPOè¦è§£å†³çš„é—®é¢˜ã€‚</p>
<p>7ï¼‰åœ¨åš PPO çš„æ—¶å€™ï¼Œæ‰€è°“çš„ KL æ•£åº¦å¹¶ä¸æ˜¯å‚æ•°çš„è·ç¦»ï¼Œè€Œæ˜¯åŠ¨ä½œçš„è·ç¦»ã€‚</p>
<p>8ï¼‰<strong>PPO-Penalty</strong></p>
<p>â€‹                    <img src="https://s2.loli.net/2022/04/16/8mg9yo1sVQJuDbk.png" alt="5.9"></p>
<p>â€‹            9ï¼‰<strong>PPO-Clip</strong></p>
<script type="math/tex; mode=display">
\begin{aligned} J_{P P O 2}^{\theta^{k}}(\theta) \approx \sum_{\left(s_{t}, a_{t}\right)} \min &\left(\frac{p_{\theta}\left(a_{t} | s_{t}\right)}{p_{\theta^{k}}\left(a_{t} | s_{t}\right)} A^{\theta^{k}}\left(s_{t}, a_{t}\right),\right.\  \\ &\left.\operatorname{clip}\left(\frac{p_{\theta}\left(a_{t} | s_{t}\right)}{p_{\theta^{k}}\left(a_{t} | s_{t}\right)}, 1-\varepsilon, 1+\varepsilon\right) A^{\theta^{k}}\left(s_{t}, a_{t}\right)\right) \end{aligned}</script><p>â€‹                </p>
<p>Min è¿™ä¸ªæ“ä½œç¬¦(operator)åšçš„äº‹æƒ…æ˜¯ç¬¬ä¸€é¡¹è·Ÿç¬¬äºŒé¡¹é‡Œé¢é€‰æ¯”è¾ƒå°çš„é‚£ä¸ªã€‚</p>
<p>ç¬¬äºŒé¡¹å‰é¢æœ‰ä¸ª clip å‡½æ•°ï¼Œclip å‡½æ•°çš„æ„æ€æ˜¯è¯´ï¼Œ</p>
<ul>
<li>åœ¨æ‹¬å·é‡Œé¢æœ‰ä¸‰é¡¹ï¼Œå¦‚æœç¬¬ä¸€é¡¹å°äºç¬¬äºŒé¡¹çš„è¯ï¼Œé‚£å°±è¾“å‡º $1-\varepsilon$ ã€‚</li>
<li>ç¬¬ä¸€é¡¹å¦‚æœå¤§äºç¬¬ä¸‰é¡¹çš„è¯ï¼Œé‚£å°±è¾“å‡º $1+\varepsilon$ã€‚</li>
</ul>
<p>$\varepsilon$ æ˜¯ä¸€ä¸ªè¶…å‚æ•°ï¼Œä½ è¦ tune çš„ï¼Œä½ å¯ä»¥è®¾æˆ 0.1 æˆ– è®¾ 0.2 ã€‚</p>
<p><img src="https://s2.loli.net/2022/04/16/M78EQ53ghfvyTO2.png" alt="5.14"></p>
<hr>
<h3 id="4æœˆ17æ—¥"><a href="#4æœˆ17æ—¥" class="headerlink" title="4æœˆ17æ—¥"></a>4æœˆ17æ—¥</h3><p>å®ç° PPOç®—æ³• ç© Pendulum-v1ã€‚</p>
<p><img src="https://s2.loli.net/2022/04/17/ObnDNdgfz4HYpcC.png"  /></p>
<hr>
<h3 id="4æœˆ18æ—¥"><a href="#4æœˆ18æ—¥" class="headerlink" title="4æœˆ18æ—¥"></a>4æœˆ18æ—¥</h3><ol>
<li><p>Actor-Criticç®—æ³•å­¦ä¹ </p>
<p>1ï¼‰<code>æ¼”å‘˜-è¯„è®ºå®¶ç®—æ³•(Actor-Critic Algorithm)</code>æ˜¯ä¸€ç§ç»“åˆ<code>ç­–ç•¥æ¢¯åº¦</code>å’Œ<code>æ—¶åºå·®åˆ†å­¦ä¹ </code>çš„å¼ºåŒ–å­¦ä¹ æ–¹æ³•ï¼Œå…¶ä¸­ï¼š</p>
<ul>
<li>æ¼”å‘˜(Actor)æ˜¯æŒ‡ç­–ç•¥å‡½æ•° $\pi_{\theta}(a|s)$ï¼Œå³å­¦ä¹ ä¸€ä¸ªç­–ç•¥æ¥å¾—åˆ°å°½é‡é«˜çš„å›æŠ¥ã€‚</li>
<li>è¯„è®ºå®¶(Critic)æ˜¯æŒ‡å€¼å‡½æ•° $V^{\pi}(s)$ï¼Œå¯¹å½“å‰ç­–ç•¥çš„å€¼å‡½æ•°è¿›è¡Œä¼°è®¡ï¼Œå³è¯„ä¼°æ¼”å‘˜çš„å¥½åã€‚</li>
<li>å€ŸåŠ©äºå€¼å‡½æ•°ï¼Œæ¼”å‘˜-è¯„è®ºå®¶ç®—æ³•å¯ä»¥è¿›è¡Œå•æ­¥æ›´æ–°å‚æ•°ï¼Œä¸éœ€è¦ç­‰åˆ°å›åˆç»“æŸæ‰è¿›è¡Œæ›´æ–°ã€‚</li>
</ul>
<p>2ï¼‰A2Câ€”â€”Advantage Actor-Critic</p>
<p>â€‹      A3Câ€”â€”Asynchronous Advantage Actor-Critic</p>
<p>3ï¼‰Q-Learning ä½¿åŸºäºä»·å€¼çš„æ–¹æ³•(value-based)ï¼Œæœ‰ä¸¤ç§ criticsã€‚</p>
<ul>
<li>ç¬¬ä¸€ç§ critic æ˜¯ $V^{\pi}(s)$ï¼Œå®ƒçš„æ„æ€æ˜¯è¯´ï¼Œå‡è®¾ actor æ˜¯ $\pi$ï¼Œæ‹¿ $\pi$ å»è·Ÿç¯å¢ƒåšäº’åŠ¨ï¼Œå½“æˆ‘ä»¬çœ‹åˆ°çŠ¶æ€ s çš„æ—¶å€™ï¼Œæ¥ä¸‹æ¥ç´¯ç§¯å¥–åŠ± çš„æœŸæœ›å€¼æœ‰å¤šå°‘ã€‚</li>
<li>è¿˜æœ‰ä¸€ä¸ª critic æ˜¯ $Q^{\pi}(s,a)$ã€‚$Q^{\pi}(s,a)$ æŠŠ s è·Ÿ a å½“ä½œè¾“å…¥ï¼Œå®ƒçš„æ„æ€æ˜¯è¯´ï¼Œåœ¨çŠ¶æ€ s é‡‡å–åŠ¨ä½œ aï¼Œæ¥ä¸‹æ¥éƒ½ç”¨ actor $\pi$ æ¥è·Ÿç¯å¢ƒè¿›è¡Œäº’åŠ¨ï¼Œç´¯ç§¯å¥–åŠ±çš„æœŸæœ›å€¼æ˜¯å¤šå°‘ã€‚</li>
<li>$V^{\pi}$ è¾“å…¥ sï¼Œè¾“å‡ºä¸€ä¸ªæ ‡é‡ã€‚</li>
<li>$Q^{\pi}$ è¾“å…¥ sï¼Œç„¶åå®ƒä¼šç»™æ¯ä¸€ä¸ª a éƒ½åˆ†é…ä¸€ä¸ª Q valueã€‚</li>
<li>ä½ å¯ä»¥ç”¨ TD æˆ– MC æ¥ä¼°è®¡ã€‚ç”¨ TD æ¯”è¾ƒç¨³ï¼Œç”¨ MC æ¯”è¾ƒç²¾ç¡®ã€‚</li>
</ul>
<p>4ï¼‰A2C (Advantage Actor-Critic)</p>
<p><img src="https://s2.loli.net/2022/04/18/xZERljQ4V6BwnLk.png" alt="9.3"></p>
<p><img src="https://s2.loli.net/2022/04/18/3bidn78rJN2HkKw.png" alt="9.4"></p>
<p><strong>A2Cç®—æ³•æµç¨‹ï¼š</strong></p>
<p><img src="https://s2.loli.net/2022/04/18/1nHLEcAvhJflDOu.png" alt="9.5"></p>
<p>ç”¨åˆ°çš„Tips:</p>
<p>ï¼ˆ1ï¼‰<strong>actor (policy) å’Œ critic (V function) çš„è¾“å…¥éƒ½æ˜¯ sï¼Œæ‰€ä»¥å®ƒä»¬å‰é¢å‡ ä¸ªå±‚(layer)æ˜¯å¯ä»¥å…±äº«çš„ã€‚</strong></p>
<p>ï¼ˆ2ï¼‰<strong>ä»ç„¶éœ€è¦æ¢ç´¢(exploration)çš„æœºåˆ¶ã€‚</strong></p>
<p>5ï¼‰A3C ï¼ˆAsynchronous(å¼‚æ­¥çš„) Advantage Actor-Criticï¼‰</p>
<p><strong>A3C è¿™ä¸ªæ–¹æ³•å°±æ˜¯åŒæ—¶å¼€å¾ˆå¤šä¸ª workerï¼Œé‚£æ¯ä¸€ä¸ª worker å…¶å®å°±æ˜¯ä¸€ä¸ªå½±åˆ†èº«ã€‚é‚£æœ€åè¿™äº›å½±åˆ†èº«ä¼šæŠŠæ‰€æœ‰çš„ç»éªŒï¼Œé€šé€šé›†åˆåœ¨ä¸€èµ·ã€‚</strong></p>
</li>
</ol>
<p>â€‹        <img src="https://s2.loli.net/2022/04/18/tYpyQ8vnWduIqe1.png" alt="9.8"></p>
<p>â€‹        6ï¼‰<strong>Pathwise Derivative Policy Gradient</strong></p>
<p>â€‹            åœ¨Q-Learningç®—æ³•åŸºç¡€ä¸Šè¿›è¡Œæ”¹å˜ã€‚</p>
<p>â€‹            <img src="https://s2.loli.net/2022/04/18/YKlXsjvpW3STLge.png" alt="9.12"></p>
<p>â€‹        <img src="https://s2.loli.net/2022/04/18/8UcKnF321vfCglZ.png" alt="9.13"></p>
<p>â€‹        7ï¼‰ GAN è·Ÿ Actor-Critic çš„æ–¹æ³•éå¸¸ç±»ä¼¼ã€‚</p>
<hr>
<h3 id="4æœˆ19æ—¥"><a href="#4æœˆ19æ—¥" class="headerlink" title="4æœˆ19æ—¥"></a>4æœˆ19æ—¥</h3><p>å®ç° A3Cç®—æ³• ç© Acrobot-v1ï¼Œå¹¶åˆ©ç”¨matplotlibç»˜åˆ¶æœŸæœ›å¥–åŠ±æ›²çº¿ã€‚</p>
<p><img src="https://s2.loli.net/2022/04/19/lR5OxEh7myNibTt.png" alt=""></p>
<p><img src="https://s2.loli.net/2022/04/19/bp5Zd3xfEAnsYJz.png" alt=""></p>
<p>19.DDPGç®—æ³•å­¦ä¹ </p>
<p>â€‹    1ï¼‰<strong>éšæœºæ€§ç­–ç•¥</strong>ä¸<strong>ç¡®å®šæ€§ç­–ç•¥</strong></p>
<ul>
<li>å¯¹éšæœºæ€§çš„ç­–ç•¥æ¥è¯´ï¼Œè¾“å…¥æŸä¸€ä¸ªçŠ¶æ€ sï¼Œé‡‡å–æŸä¸€ä¸ª action çš„å¯èƒ½æ€§å¹¶ä¸æ˜¯ç™¾åˆ†ä¹‹ç™¾ï¼Œè€Œæ˜¯æœ‰ä¸€ä¸ªæ¦‚ç‡ P çš„ï¼Œå°±å¥½åƒæŠ½å¥–ä¸€æ ·ï¼Œæ ¹æ®æ¦‚ç‡éšæœºæŠ½å–ä¸€ä¸ªåŠ¨ä½œã€‚</li>
<li>è€Œå¯¹äºç¡®å®šæ€§çš„ç­–ç•¥æ¥è¯´ï¼Œå®ƒæ²¡æœ‰æ¦‚ç‡çš„å½±å“ã€‚å½“ç¥ç»ç½‘ç»œçš„å‚æ•°å›ºå®šä¸‹æ¥äº†ä¹‹åï¼Œè¾“å…¥åŒæ ·çš„ stateï¼Œå¿…ç„¶è¾“å‡ºåŒæ ·çš„ actionï¼Œè¿™å°±æ˜¯ç¡®å®šæ€§çš„ç­–ç•¥ã€‚</li>
</ul>
<p><img src="https://s2.loli.net/2022/04/19/GJ58IULaNuQFMyf.png" alt="12.3"></p>
<p>â€‹    *tanh çš„å›¾åƒçš„åƒå³è¾¹è¿™æ ·å­ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯æŠŠè¾“å‡ºé™åˆ¶åˆ° [-1,1] ä¹‹é—´ã€‚</p>
<p>â€‹    2ï¼‰DDPG çš„ç‰¹ç‚¹å¯ä»¥ä»å®ƒçš„åå­—ï¼ˆ<strong>Deep Deterministic Policy Gradient</strong>ï¼‰å½“ä¸­æ‹†è§£å‡ºæ¥ï¼Œæ‹†è§£æˆ Deepã€Deterministic å’Œ Policy Gradientã€‚</p>
<ul>
<li>Deep æ˜¯å› ä¸ºç”¨äº†ç¥ç»ç½‘ç»œï¼›</li>
<li>Deterministic è¡¨ç¤º DDPG è¾“å‡ºçš„æ˜¯ä¸€ä¸ªç¡®å®šæ€§çš„åŠ¨ä½œï¼Œå¯ä»¥ç”¨äºè¿ç»­åŠ¨ä½œçš„ä¸€ä¸ªç¯å¢ƒï¼›</li>
<li>Policy Gradient ä»£è¡¨çš„æ˜¯å®ƒç”¨åˆ°çš„æ˜¯ç­–ç•¥ç½‘ç»œã€‚REINFORCE ç®—æ³•æ¯éš”ä¸€ä¸ª episode å°±æ›´æ–°ä¸€æ¬¡ï¼Œä½† DDPG ç½‘ç»œæ˜¯æ¯ä¸ª step éƒ½ä¼šæ›´æ–°ä¸€æ¬¡ policy ç½‘ç»œï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯ä¸€ä¸ª<strong>å•æ­¥æ›´æ–°</strong>çš„ policy ç½‘ç»œã€‚</li>
</ul>
<p><img src="https://s2.loli.net/2022/04/19/PFIsq5jQR1Ogc7h.png" alt="12.5"></p>
<p>â€‹    <strong>æå‡º DDPG æ˜¯ä¸ºäº†è®© DQN å¯ä»¥æ‰©å±•åˆ°è¿ç»­çš„åŠ¨ä½œç©ºé—´</strong>ã€‚</p>
<ul>
<li>DDPG ç›´æ¥åœ¨ DQN åŸºç¡€ä¸ŠåŠ äº†ä¸€ä¸ª<strong>ç­–ç•¥ç½‘ç»œ</strong>æ¥ç›´æ¥è¾“å‡ºåŠ¨ä½œå€¼ï¼Œæ‰€ä»¥ DDPG éœ€è¦<strong>ä¸€è¾¹å­¦ä¹  Q ç½‘ç»œï¼Œä¸€è¾¹å­¦ä¹ ç­–ç•¥ç½‘ç»œ</strong>ã€‚</li>
<li>Q ç½‘ç»œçš„å‚æ•°ç”¨ $w$ æ¥è¡¨ç¤ºã€‚ç­–ç•¥ç½‘ç»œçš„å‚æ•°ç”¨ $\theta$ æ¥è¡¨ç¤ºã€‚</li>
<li>æˆ‘ä»¬ç§°è¿™æ ·çš„ç»“æ„ä¸º <code>Actor-Critic</code> çš„ç»“æ„ã€‚</li>
</ul>
<p><img src="https://pic.rmb.bdstatic.com/bjh/db7ae6e4b2c3a5d1cafcbdee2fef5b74.png" alt="12.7.png"></p>
<p>â€‹    <img src="https://pic.rmb.bdstatic.com/bjh/2872fb7c5072cdfd51f58d020be79b47.png" alt="12.8.png"></p>
<ul>
<li>DDPG æœ‰å››ä¸ªç½‘ç»œï¼Œ<strong>ç­–ç•¥ç½‘ç»œçš„ target ç½‘ç»œ</strong> å’Œ <strong>Q ç½‘ç»œçš„ target ç½‘ç»œ</strong>å°±æ˜¯é¢œè‰²æ¯”è¾ƒæ·±çš„è¿™ä¸¤ä¸ªï¼Œå®ƒåªæ˜¯ä¸ºäº†è®©è®¡ç®— Q_target çš„æ—¶å€™èƒ½å¤Ÿæ›´ç¨³å®šä¸€ç‚¹è€Œå·²ã€‚<strong>å› ä¸ºè¿™ä¸¤ä¸ªç½‘ç»œä¹Ÿæ˜¯å›ºå®šä¸€æ®µæ—¶é—´çš„å‚æ•°ä¹‹åå†è·Ÿè¯„ä¼°ç½‘ç»œåŒæ­¥ä¸€ä¸‹æœ€æ–°çš„å‚æ•°ã€‚</strong></li>
<li>å› ä¸º DDPG ä½¿ç”¨äº†ç»éªŒå›æ”¾è¿™ä¸ªæŠ€å·§ï¼Œæ‰€ä»¥ DDPG æ˜¯ä¸€ä¸ª <code>off-policy</code> çš„ç®—æ³•ã€‚</li>
</ul>
<p>â€‹    3ï¼‰<strong>TD3</strong>ï¼ˆTwin Delayed DDPG åŒå»¶è¿Ÿæ·±åº¦ç¡®å®šæ€§ç­–ç•¥æ¢¯åº¦ï¼‰</p>
<ul>
<li><p><strong>æˆªæ–­çš„åŒ Q å­¦ä¹ (Clipped Dobule Q-learning)</strong> ã€‚TD3 å­¦ä¹ ä¸¤ä¸ª Q-functionï¼ˆå› æ­¤åå­—ä¸­æœ‰ â€œtwinâ€ï¼‰ã€‚TD3 é€šè¿‡æœ€å°åŒ–å‡æ–¹è¯¯å·®æ¥åŒæ—¶å­¦ä¹ ä¸¤ä¸ª Q-functionï¼š$Q_{\phi_1}$ å’Œ $Q_{\phi_2}$ã€‚ä¸¤ä¸ª Q-function éƒ½ä½¿ç”¨ä¸€ä¸ªç›®æ ‡ï¼Œä¸¤ä¸ª Q-function ä¸­ç»™å‡ºè¾ƒå°çš„å€¼ä¼šè¢«ä½œä¸ºå¦‚ä¸‹çš„ Q-targetï¼š</p>
<script type="math/tex; mode=display">
y\left(r, s^{\prime}, d\right)=r+\gamma(1-d) \min_{i=1,2} Q_{\phi_{i, t a r g}}\left(s^{\prime}, a_{T D 3}\left(s^{\prime}\right)\right)</script></li>
<li><p><strong>å»¶è¿Ÿçš„ç­–ç•¥æ›´æ–°(â€œDelayedâ€ Policy Updates)</strong> ã€‚ç›¸å…³å®éªŒç»“æœè¡¨æ˜ï¼ŒåŒæ­¥è®­ç»ƒåŠ¨ä½œç½‘ç»œå’Œè¯„ä»·ç½‘ç»œï¼Œå´ä¸ä½¿ç”¨ç›®æ ‡ç½‘ç»œï¼Œä¼šå¯¼è‡´è®­ç»ƒè¿‡ç¨‹ä¸ç¨³å®šï¼›ä½†æ˜¯ä»…å›ºå®šåŠ¨ä½œç½‘ç»œæ—¶ï¼Œè¯„ä»·ç½‘ç»œå¾€å¾€èƒ½å¤Ÿæ”¶æ•›åˆ°æ­£ç¡®çš„ç»“æœã€‚å› æ­¤ TD3 ç®—æ³•ä»¥è¾ƒä½çš„é¢‘ç‡æ›´æ–°åŠ¨ä½œç½‘ç»œï¼Œè¾ƒé«˜é¢‘ç‡æ›´æ–°è¯„ä»·ç½‘ç»œï¼Œé€šå¸¸æ¯æ›´æ–°ä¸¤æ¬¡è¯„ä»·ç½‘ç»œå°±æ›´æ–°ä¸€æ¬¡ç­–ç•¥ã€‚</p>
</li>
<li><p><strong>ç›®æ ‡ç­–ç•¥å¹³æ»‘(Target Policy smoothing)</strong> ã€‚TD3 å¼•å…¥äº† smoothing çš„æ€æƒ³ã€‚TD3 åœ¨ç›®æ ‡åŠ¨ä½œä¸­åŠ å…¥å™ªéŸ³ï¼Œé€šè¿‡å¹³æ»‘ Q æ²¿åŠ¨ä½œçš„å˜åŒ–ï¼Œä½¿ç­–ç•¥æ›´éš¾åˆ©ç”¨ Q å‡½æ•°çš„è¯¯å·®ã€‚</p>
<p>ç›®æ ‡ç­–ç•¥å¹³æ»‘åŒ–(ä¸€ç§æ­£åˆ™åŒ–æ–¹æ³•)çš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š</p>
<script type="math/tex; mode=display">
a_{T D 3}\left(s^{\prime}\right)=\operatorname{clip}\left(\mu_{\theta, t a r g}\left(s^{\prime}\right)+\operatorname{clip}(\epsilon,-c, c), a_{\text {low }}, a_{\text {high }}\right)</script><p>å…¶ä¸­ $\epsilon$ æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå™ªå£°ï¼Œæ˜¯ä»æ­£æ€åˆ†å¸ƒä¸­å–æ ·å¾—åˆ°çš„ï¼Œå³ $\epsilon \sim N(0,\sigma)$ã€‚</p>
</li>
</ul>
<hr>
<h3 id="4æœˆ20æ—¥"><a href="#4æœˆ20æ—¥" class="headerlink" title="4æœˆ20æ—¥"></a>4æœˆ20æ—¥</h3><p>ç ”è¯»Openai gym Wikiä¸­å¤§ä½¬ä»¬çš„ä»£ç ã€‚</p>
<p><img src="https://s2.loli.net/2022/04/20/jKGMJOwI5uBi8TZ.png" alt=""></p>
<ol>
<li><p>æ·±åº¦å¼ºåŒ–å­¦ä¹ ç®—æ³•ä¼ªä»£ç æ±‡æ€»ï¼š</p>
<p>1ï¼‰DQN</p>
</li>
</ol>
<p><img src="https://s2.loli.net/2022/04/20/kwxHRvQ6UEIlshf.png" alt=""></p>
<p>â€‹    2ï¼‰PPO</p>
<p>â€‹    <img src="https://pic.rmb.bdstatic.com/bjh/e0beb3014d9953aaf1deac573d782228.png" alt="BWQ@UA}78G_T[VI0P_EC]8B.png"></p>
<p>â€‹    3ï¼‰A3C</p>
<p>â€‹    <img src="https://pic.rmb.bdstatic.com/bjh/e5ce498c4f16a558d8e7becbf22005ef.png" alt=""></p>
<p>â€‹    4ï¼‰DDPG</p>
<p>â€‹    <img src="https://pic.rmb.bdstatic.com/bjh/5e6b9882c2dae56a41a99a638ec529bb.png" alt="@C@P8TJAY{3F5JW8UR9YYKE.png"></p>
<hr>
<h3 id="4æœˆ21æ—¥"><a href="#4æœˆ21æ—¥" class="headerlink" title="4æœˆ21æ—¥"></a>4æœˆ21æ—¥</h3><p>æŠŠæ·±åº¦å¼ºåŒ–å­¦ä¹ ä¸»è¦ç®—æ³•è¿‡äº†ä¸€éï¼Œä¹Ÿèƒ½è·‘é€šgymä¸Šçš„ç¯å¢ƒï¼Œå‘ç°è‡ªå·±å¹¶ä¸èƒ½æ ¹æ®ç®—æ³•è¿›è¡Œä»£ç çš„å¤ç°ï¼Œè€Œä¸”å¯¹ä¸€äº›æ·±åº¦å­¦ä¹ ç½‘ç»œæ¨¡å‹ä¹Ÿä¸æ˜¯å¾ˆäº†è§£ï¼Œå†³å®šä»ä»Šå¤©å¼€å§‹å•ƒã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹ï¼ˆPytorchç‰ˆæœ¬ï¼‰</p>
<p><img src="https://s2.loli.net/2022/04/21/STYRBn8igxw9FO4.jpg" alt="v2-5642db38e1f5d74b81ae90c55d549553_1440w"></p>
<p><a target="_blank" rel="noopener" href="https://panmingyan.github.io/2022/04/20/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#more">æˆ‘çš„æ·±åº¦å­¦ä¹ è®°å½•</a></p>
<hr>
<h3 id="5æœˆ9æ—¥"><a href="#5æœˆ9æ—¥" class="headerlink" title="5æœˆ9æ—¥"></a>5æœˆ9æ—¥</h3><p>ä»ä»Šå¤©å¼€å§‹æ¥ç€å•ƒå¼ºåŒ–å­¦ä¹ äº†ğŸ¤–</p>
<p><img src="https://m.360buyimg.com/babel/jfs/t1/191259/27/23918/162019/6278e481Eac0df82e/e2895d20785cf286.png" alt="f8eab5537723deda01756e110e0f9370.jpeg"></p>
<hr>
<h3 id="MDP"><a href="#MDP" class="headerlink" title="MDP"></a>MDP</h3><ul>
<li><h4 id="Policy-Iteration"><a href="#Policy-Iteration" class="headerlink" title="Policy Iteration"></a>Policy Iteration</h4></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> gym</span><br><span class="line"><span class="keyword">from</span> gym <span class="keyword">import</span> wrappers</span><br><span class="line"><span class="keyword">from</span> gym.envs.registration <span class="keyword">import</span> register</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_episode</span>(<span class="params">env, policy, gamma = <span class="number">1.0</span>, render = <span class="literal">False</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Runs an episode and return the total reward &quot;&quot;&quot;</span></span><br><span class="line">    obs = env.reset()</span><br><span class="line">    total_reward = <span class="number">0</span></span><br><span class="line">    step_idx = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> render:</span><br><span class="line">            env.render()</span><br><span class="line">        obs, reward, done , _ = env.step(<span class="built_in">int</span>(policy[obs]))</span><br><span class="line">        total_reward += (gamma ** step_idx * reward)</span><br><span class="line">        step_idx += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> done:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> total_reward</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">evaluate_policy</span>(<span class="params">env, policy, gamma = <span class="number">1.0</span>, n = <span class="number">100</span></span>):</span></span><br><span class="line">    scores = [run_episode(env, policy, gamma, <span class="literal">False</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">    <span class="keyword">return</span> np.mean(scores)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">extract_policy</span>(<span class="params">v, gamma = <span class="number">1.0</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Extract the policy given a value-function &quot;&quot;&quot;</span></span><br><span class="line">    policy = np.zeros(<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        q_sa = np.zeros(<span class="number">4</span>)</span><br><span class="line">        <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            q_sa[a] = <span class="built_in">sum</span>([p * (r + gamma * v[s_]) <span class="keyword">for</span> p, s_, r, _ <span class="keyword">in</span>  env.env.P[s][a]])</span><br><span class="line">        policy[s] = np.argmax(q_sa)</span><br><span class="line">    <span class="keyword">return</span> policy</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compute_policy_v</span>(<span class="params">env, policy, gamma=<span class="number">1.0</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Iteratively evaluate the value-function under policy.</span></span><br><span class="line"><span class="string">    Alternatively, we could formulate a set of linear equations in iterms of v[s] </span></span><br><span class="line"><span class="string">    and solve them to find the value function.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    v = np.zeros(<span class="number">16</span>)</span><br><span class="line">    eps = <span class="number">1e-10</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        prev_v = np.copy(v)</span><br><span class="line">        <span class="keyword">for</span> s <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">            policy_a = policy[s]</span><br><span class="line">            v[s] = <span class="built_in">sum</span>([p * (r + gamma * prev_v[s_]) <span class="keyword">for</span> p, s_, r, _ <span class="keyword">in</span> env.env.P[s][policy_a]])</span><br><span class="line">        <span class="keyword">if</span> (np.<span class="built_in">sum</span>((np.fabs(prev_v - v))) &lt;= eps):</span><br><span class="line">            <span class="comment"># value converged</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">policy_iteration</span>(<span class="params">env, gamma = <span class="number">1.0</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Policy-Iteration algorithm &quot;&quot;&quot;</span></span><br><span class="line">    policy = np.random.choice(<span class="number">4</span>, size=(<span class="number">16</span>))  <span class="comment"># initialize a random policy</span></span><br><span class="line">    max_iterations = <span class="number">200000</span></span><br><span class="line">    gamma = <span class="number">1.0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(max_iterations):</span><br><span class="line">        old_policy_v = compute_policy_v(env, policy, gamma)</span><br><span class="line">        new_policy = extract_policy(old_policy_v, gamma)</span><br><span class="line">        <span class="keyword">if</span> (np.<span class="built_in">all</span>(policy == new_policy)):</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&#x27;Policy-Iteration converged at step %d.&#x27;</span> %(i+<span class="number">1</span>))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        policy = new_policy</span><br><span class="line">    <span class="keyword">return</span> policy</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    env_name  = <span class="string">&#x27;FrozenLake-v1&#x27;</span> <span class="comment"># &#x27;FrozenLake8x8-v0&#x27;</span></span><br><span class="line">    env = gym.make(env_name)</span><br><span class="line"></span><br><span class="line">    optimal_policy = policy_iteration(env, gamma = <span class="number">1.0</span>)</span><br><span class="line">    scores = evaluate_policy(env, optimal_policy, gamma = <span class="number">1.0</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Average scores = &#x27;</span>, np.mean(scores))</span><br></pre></td></tr></table></figure>
<ul>
<li><h4 id="Value-Iteration"><a href="#Value-Iteration" class="headerlink" title="Value Iteration"></a>Value Iteration</h4></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> gym</span><br><span class="line"><span class="keyword">from</span> gym <span class="keyword">import</span> wrappers</span><br><span class="line"><span class="keyword">from</span> gym.envs.registration <span class="keyword">import</span> register</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_episode</span>(<span class="params">env, policy, gamma = <span class="number">1.0</span>, render = <span class="literal">False</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Evaluates policy by using it to run an episode and finding its</span></span><br><span class="line"><span class="string">    total reward.</span></span><br><span class="line"><span class="string">    args:</span></span><br><span class="line"><span class="string">    env: gym environment.</span></span><br><span class="line"><span class="string">    policy: the policy to be used.</span></span><br><span class="line"><span class="string">    gamma: discount factor.</span></span><br><span class="line"><span class="string">    render: boolean to turn rendering on/off.</span></span><br><span class="line"><span class="string">    returns:</span></span><br><span class="line"><span class="string">    total reward: real value of the total reward recieved by agent under policy.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    obs = env.reset()</span><br><span class="line">    total_reward = <span class="number">0</span></span><br><span class="line">    step_idx = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> render:</span><br><span class="line">            env.render()</span><br><span class="line">        obs, reward, done , _ = env.step(<span class="built_in">int</span>(policy[obs]))</span><br><span class="line">        total_reward += (gamma ** step_idx * reward)</span><br><span class="line">        step_idx += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> done:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> total_reward</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">evaluate_policy</span>(<span class="params">env, policy, gamma = <span class="number">1.0</span>,  n = <span class="number">100</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Evaluates a policy by running it n times.</span></span><br><span class="line"><span class="string">    returns:</span></span><br><span class="line"><span class="string">    average total reward</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    scores = [</span><br><span class="line">            run_episode(env, policy, gamma = gamma, render = <span class="literal">False</span>)</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">    <span class="keyword">return</span> np.mean(scores)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">extract_policy</span>(<span class="params">v, gamma = <span class="number">1.0</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Extract the policy given a value-function &quot;&quot;&quot;</span></span><br><span class="line">    policy = np.zeros(<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        q_sa = np.zeros(env.action_space.n)</span><br><span class="line">        <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(env.action_space.n):</span><br><span class="line">            <span class="keyword">for</span> next_sr <span class="keyword">in</span> env.env.P[s][a]:</span><br><span class="line">                <span class="comment"># next_sr is a tuple of (probability, next state, reward, done)</span></span><br><span class="line">                p, s_, r, _ = next_sr</span><br><span class="line">                q_sa[a] += (p * (r + gamma * v[s_]))</span><br><span class="line">        policy[s] = np.argmax(q_sa)</span><br><span class="line">    <span class="keyword">return</span> policy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">value_iteration</span>(<span class="params">env, gamma = <span class="number">1.0</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Value-iteration algorithm &quot;&quot;&quot;</span></span><br><span class="line">    v = np.zeros(<span class="number">16</span>)  <span class="comment"># initialize value-function</span></span><br><span class="line">    max_iterations = <span class="number">100000</span></span><br><span class="line">    eps = <span class="number">1e-20</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(max_iterations):</span><br><span class="line">        prev_v = np.copy(v)</span><br><span class="line">        <span class="keyword">for</span> s <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">            q_sa = [<span class="built_in">sum</span>([p*(r + gamma * prev_v[s_]) <span class="keyword">for</span> p, s_, r, _ <span class="keyword">in</span> env.env.P[s][a]]) <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)] </span><br><span class="line">            v[s] = <span class="built_in">max</span>(q_sa)</span><br><span class="line">        <span class="keyword">if</span> (np.<span class="built_in">sum</span>(np.fabs(prev_v - v)) &lt;= eps):</span><br><span class="line">            <span class="built_in">print</span> (<span class="string">&#x27;Value-iteration converged at iteration# %d.&#x27;</span> %(i+<span class="number">1</span>))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    env_name  = <span class="string">&#x27;FrozenLake-v1&#x27;</span> <span class="comment"># &#x27;FrozenLake8x8-v0&#x27;</span></span><br><span class="line">    env = gym.make(env_name)</span><br><span class="line">    gamma = <span class="number">1.0</span></span><br><span class="line">    optimal_v = value_iteration(env, gamma);</span><br><span class="line">    policy = extract_policy(optimal_v, gamma)</span><br><span class="line">    policy_score = evaluate_policy(env, policy, gamma, n=<span class="number">1000</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Policy average score = &#x27;</span>, policy_score, <span class="string">&#x27;The best policy = &#x27;</span>, policy)</span><br></pre></td></tr></table></figure>
<h3 id="MC"><a href="#MC" class="headerlink" title="MC"></a>MC</h3><p>ä»£ç åœ°å€ï¼š<strong>Hands-on-RL / ç¬¬3ç« -é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹.ipynb</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/boyu-ai/Hands-on-RL/blob/main/%E7%AC%AC3%E7%AB%A0-%E9%A9%AC%E5%B0%94%E5%8F%AF%E5%A4%AB%E5%86%B3%E7%AD%96%E8%BF%87%E7%A8%8B.ipynb">https://github.com/boyu-ai/Hands-on-RL/blob/main/%E7%AC%AC3%E7%AB%A0-%E9%A9%AC%E5%B0%94%E5%8F%AF%E5%A4%AB%E5%86%B3%E7%AD%96%E8%BF%87%E7%A8%8B.ipynb</a></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0/" rel="tag"><i class="fa fa-tag"></i>å¼ºåŒ–å­¦ä¹ </a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/04/09/%E5%B0%81%E9%9D%A23-22/" rel="prev" title="å°é¢">
      <i class="fa fa-chevron-left"></i> å°é¢
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/04/12/DQN%E5%80%92%E7%AB%8B%E6%91%86%E4%BB%A3%E7%A0%81%E8%A7%A3%E6%9E%90/" rel="next" title="DQNå€’ç«‹æ‘†ä»£ç è§£æ">
      DQNå€’ç«‹æ‘†ä»£ç è§£æ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E6%9C%8811%E6%97%A5"><span class="nav-number">1.</span> <span class="nav-text">4æœˆ11æ—¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E6%9C%8812%E6%97%A5"><span class="nav-number">2.</span> <span class="nav-text">4æœˆ12æ—¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E6%9C%8813%E6%97%A5"><span class="nav-number">3.</span> <span class="nav-text">4æœˆ13æ—¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E6%9C%8814%E6%97%A5"><span class="nav-number">4.</span> <span class="nav-text">4æœˆ14æ—¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E6%9C%8815%E6%97%A5"><span class="nav-number">5.</span> <span class="nav-text">4æœˆ15æ—¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E6%9C%8816%E6%97%A5"><span class="nav-number">6.</span> <span class="nav-text">4æœˆ16æ—¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E6%9C%8817%E6%97%A5"><span class="nav-number">7.</span> <span class="nav-text">4æœˆ17æ—¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E6%9C%8818%E6%97%A5"><span class="nav-number">8.</span> <span class="nav-text">4æœˆ18æ—¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E6%9C%8819%E6%97%A5"><span class="nav-number">9.</span> <span class="nav-text">4æœˆ19æ—¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E6%9C%8820%E6%97%A5"><span class="nav-number">10.</span> <span class="nav-text">4æœˆ20æ—¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E6%9C%8821%E6%97%A5"><span class="nav-number">11.</span> <span class="nav-text">4æœˆ21æ—¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%E6%9C%889%E6%97%A5"><span class="nav-number">12.</span> <span class="nav-text">5æœˆ9æ—¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MDP"><span class="nav-number">13.</span> <span class="nav-text">MDP</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Policy-Iteration"><span class="nav-number">13.1.</span> <span class="nav-text">Policy Iteration</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Value-Iteration"><span class="nav-number">13.2.</span> <span class="nav-text">Value Iteration</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MC"><span class="nav-number">14.</span> <span class="nav-text">MC</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="P.M.Y"
      src="/images/creator.jpg">
  <p class="site-author-name" itemprop="name">P.M.Y</p>
  <div class="site-description" itemprop="description">è®°å½•Â·åˆ†äº«Â·è¿›æ­¥</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">P.M.Y</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
